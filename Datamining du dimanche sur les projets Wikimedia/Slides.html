<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=no">

		<title>Datamining du dimanche sur les projets Wikimedia</title>

		<link rel="stylesheet" href="../reveal.js/css/reveal.css">
		<link rel="stylesheet" href="../reveal.js/css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="../reveal.js/lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? '../reveal.js/css/print/pdf.css' : '../reveal.js/css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
		<style type="text/css">
			section {
				height: 100%;
				width: 100%;
			}
			.caption {
				position: absolute;
				bottom: 0px;
				right: 0px;
			}
		</style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h2 style="margin-top: 5%">Datamining du dimanche sur les projets Wikimedia</h2>
					<p>
						<a href="https://commons.wikimedia.org/wiki/File:Magnifying_glass_with_focus_on_paper.png"><img src="images/Magnifying_glass_with_focus_on_paper.jpg" style="width: 50%;"></a>
						<br>
						<small style="font-size: 40%">© Niabot, CC-BY-SA 3.0</small>
						<br>
						<a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — WikiConvention francophone 2016
					</p>
				</section>
				<section>
					<h2>Datamining ?</h2>
					<p>
						<a href="https://commons.wikimedia.org/wiki/File:Magnifying_glass_with_focus_on_paper.png"><img src="images/Magnifying_glass_with_focus_on_paper.jpg" style="width: 40%;"></a>
						<br>
						<small style="font-size: 40%">© Niabot, CC-BY-SA 3.0</small>
					</p>
					<ul>
						<li>Extraire (ou fouiller) des données</li>
						<li class="fragment">… qui n'ont pas forcément été prévues pour ça</li>
						<li class="fragment">… voire pas prévues du tout</li>
					</ul>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>À la main</h2>
					<p>
						<a href="https://commons.wikimedia.org/wiki/File:Bundesarchiv_Bild_183-13175-0015,_Bergarbeiter_bohrend.jpg"><img src="images/Bundesarchiv_Bild_183-13175-0015,_Bergarbeiter_bohrend.jpg" style="width: 20%;"></a>
						<br>
						<small style="font-size: 40%">© Günther Paalzow, Deutsches Bundesarchiv, CC-BY-SA 3.0</small>
					</p>
					<ul>
						<li><a href="https://fr.wikipedia.org/wiki/ZAC_Pajol">ZAC Pajol</a></li>
					</ul>
					<pre class="fragment"><code>
$ curl 'https://fr.wikipedia.org/wiki/ZAC_Pajol'
					</code></pre>
					<pre class="fragment"><code>
$ curl 'https://fr.wikipedia.org/wiki/ZAC_Pajol?action=render'
$ curl 'https://fr.wikipedia.org/wiki/ZAC_Pajol?action=raw'
					</code></pre>
					<pre class="fragment"><code>
$ curl 'https://fr.wikipedia.org/wiki/ZAC_Pajol?action=raw&amp;section=0'
					</code></pre>
					<ul class="fragment">
						<li><a href="https://fr.wikipedia.org/wiki/Spécial:Export">[[Spécial:Export]]</a></li>
					</ul>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>curl &amp; wget</h2>
					<p>
						<a href="https://commons.wikimedia.org/wiki/File:Curl-logo.svg"><img src="images/Curl-logo.svg.png" style="width: 20%;"></a>
						<br>
						<small style="font-size: 40%">© Soft Dreams, CC-BY-SA 4.0</small>
					</p>
					<pre><code>
$ curl 'https://fr.wikipedia.org/wiki/ZAC_Pajol'
$ wget 'https://fr.wikipedia.org/wiki/ZAC_Pajol'
					</code></pre>
					<pre class="fragment"><code>
$ curl 'https://fr.wikipedia.org/wiki/ZAC_Pajol' -O
$ wget 'https://fr.wikipedia.org/wiki/ZAC_Pajol' -O -
					</code></pre>
					<ul class="fragment">
						<li>curl supporte (beaucoup) plus de protocoles</li>
						<li>wget supporte les téléchargement récursifs</li>
						<li class="fragment">Même nombre de caractères…<ul>
							<li class="fragment">… mais on peut taper <kbd>wget</kbd> avec juste la main gauche ;-)</li>
						</ul></li>
					</ul>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Les dumps</h2>
					<p>
						<a href="https://commons.wikimedia.org/wiki/File:Building_Fairs_Brno_2011_(082).jpg"><img src="images/Building_Fairs_Brno_2011_(082).jpg" style="width: 20%;"></a>
						<br>
						<small style="font-size: 40%">© Pavel Ševela, CC-BY-SA 3.0</small>
					</p>
					<ul>
						<li><a href="https://dumps.wikimedia.org/">dumps.wikimedia.org</a></li>
						<li class="fragment"><a href="https://dumps.wikimedia.org/frwiki/latest">dumps.wikimedia.org/frwiki/latest</a><ul>
							<li class="fragment"><i>pages-meta-history</i> : toutes les pages + historiques<ul>
								<li class="fragment">plusieurs Tio pour enwiki !</li>
							</ul></li>
							<li class="fragment"><i>pages-meta-current</i> : toutes les pages, sans l'historique</li>
							<li class="fragment"><strong><i>pages-articles</i></strong> : articles + modèles, sans l'historique<ul>
								<li class="fragment">~ 15 Gio pour frwiki ; ~ 50 Gio pour enwiki</li>
							</ul></li>
							<li class="fragment"><i>stub-meta-history</i> : seulement les métadonnées + historiques</li>
							<li class="fragment"><i>all-titles</i> : seulement les titres</li>
							<li class="fragment"><i>*.rss</i> : pour être prévenu des mises à jour</li>
						</ul></li>
					</ul>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Les dumps</h2>
					<pre><code>
$ wget 'https://dumps.wikimedia.org/frwiki/latest/frwiki-latest-pages-articles.xml.bz2' -O - | \
  bunzip2 > frwiki.xml
					</code></pre>
					<ul class="fragment">
						<li>Et pour du texte brut ?<ul>
							<li class="fragment"><a href="https://github.com/attardi/wikiextractor">WikiExtractor</a></li>
							<li class="fragment"><a href="https://dumps.wikimedia.org/other/cirrussearch/">dumps.wikimedia.org/other/cirrussearch/</a></li>
						</ul></li>
					</ul>
					<pre class="fragment"><code>
$ wget 'https://dumps.wikimedia.org/other/cirrussearch/current/frwiki-20160815-cirrussearch-content.json.gz' -O - | \
  gunzip > frwiki.json
					</code></pre>
					<pre class="fragment"><code>
$ < frwiki.json | jq '.source_text | select(. != null)'
					</code></pre>
					<pre class="fragment"><code>
$ < frwiki.json | jq -r '.text | select(. != null)'
					</code></pre>
					<pre class="fragment"><code>
$ wget 'https://dumps.wikimedia.org/other/cirrussearch/current/frwiki-20160815-cirrussearch-content.json.gz' -O - | \
  gunzip | \
  jq -r '.text | select(. != null)'
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>jq</h2>
					<p>
						<a href="https://stedolan.github.io/jq/"><img src="images/jq.png" style="width: 20%;"></a>
						<br>
						<small style="font-size: 40%">© Stephen Dolan, CC-BY 3.0</small>
					</p>
					<ul>
						<li>Filtrer, extraire, formater du JSON</li>
					</ul>
					<pre class="fragment"><code>
jq '.'
					</code></pre>
					<pre class="fragment"><code>
jq '.[0]'
					</code></pre>
					<pre class="fragment"><code>
jq '.[] | { nom: .personne.nom, role: .role.nom }'
					</code></pre>
					<pre class="fragment"><code>
jq '.[] | length'
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Synonymes : CRISCO DES</h2>
					<p>
						<a href="http://www.crisco.unicaen.fr/des/synonymes/encyclop%C3%A9die"><img src="images/des.png" style="width: 35%;"></a>
						<br>
						<small style="font-size: 40%">© ELSAP, CRISCO, Université de Caen Basse-Normandie</small>
					</p>
					<ul>
						<li><a href="http://www.crisco.unicaen.fr/des/">www.crisco.unicaen.fr/des/</a></li>
						<li class="fragment">49 332 entrées</li>
						<li class="fragment">203 797 relations</li>
						<li class="fragment">… classés par proximité, etc.</li>
					</ul>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Synonymes : WOLF</h2>
					<p>
						<a href="http://alpage.inria.fr/~sagot/wolf.html"><img src="images/wolf.png" style="width: 35%;"></a>
						<br>
						<small style="font-size: 40%">© Benoît Sagot, Darja Fiser et al., INRIA, Cecill-C</small>
					</p>
					<ul>
						<li>« Wordnet Libre du Français »</li>
						<li><a href="https://gforge.inria.fr/projects/wolf/">gforge.inria.fr/projects/wolf/</a></li>
					</ul>
					<pre class="fragment"><code>
$ wget 'https://gforge.inria.fr/frs/download.php/file/33496/wolf-1.0b4.xml.bz2' -O - | \
   bunzip2 > wolf-1.0b4.xml
					</code></pre>
					<pre class="fragment"><code>
$ less wolf-1.0b4.xml
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>XMLStarlet</h2>
					<p>
						<a href="http://xmlstar.sourceforge.net/"><img src="images/xmlstarlet.png" style="width: 20%;"></a>
						<br>
						<small style="font-size: 40%">© Mikhail Grushinskiy, MIT</small>
					</p>
					<ul>
						<li>Filtrer, extraire, formater du XML<ul class="fragment">
							<li>avec XPATH et XSLT<ul class="fragment">
								<li>mais sans XSLT</li>
							</ul></li>
						</ul></li>
					</ul>
					<pre class="fragment"><code>
xml sel -t -c root
					</code></pre>
					<pre class="fragment"><code>
xml sel -t -m '//foo' -v 'bar'
					</code></pre>
					<pre class="fragment"><code>
xml sel -t -m '//foo[@name!="bad"]' -v 'bar' -o " -> " -v 'baz'
					</code></pre>
					<pre class="fragment"><code>
xml sel -t -v 'cout(/)'
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Synonymes : WOLF</h2>
					<pre><code>
$ < wolf-1.0b4.xml \
   sed '2d' | \
   xml sel -t \
     -m '//SYNSET' \
     -m 'SYNONYM[LITERAL!="_EMPTY_"]' \
     -n \
       -v LITERAL \
       -n \
   > /tmp/wolf-1.0b4.syn
					</code></pre>
					<pre class="fragment"><code>
$ less /tmp/wolf-1.0b4.syn
					</code></pre>
					<pre class="fragment"><code>
$ < wolf-1.0b4.xml \
   sed '2d' | \
   xml sel -t \
     -m '//SYNSET' \
     -m 'SYNONYM[LITERAL!="_EMPTY_"]' \
     -v "count(LITERAL)" \
     -n | \
   grep -v '^[01]$' | \
   > counts.lst
					</code></pre>
					<pre class="fragment"><code>
$ < counts.lst
   datamash sum 1
62452
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>sed / awk</h2>
					<p>
						<a href="https://commons.wikimedia.org/wiki/File:LorisLyd1.png"><img src="images/LorisLyd1.png" style="width: 20%;"></a>
						<br>
						<small style="font-size: 40%">c̶ Richard Lydekker, DP</small>
					</p>
					<ul>
						<li>Filtrer, extraire, formater du texte</li>
					</ul>
					<pre class="fragment"><code>
$ ( echo a a ; echo b b ; echo c c) | sed '2d'
$ ( echo a a ; echo b b ; echo c c) | awk 'NR != 2'
					</code></pre>
					<pre class="fragment"><code>
$ ( echo a a ; echo b b ; echo c c) | awk '/b/ { $1 = "A" } { print }'
					</code></pre>
					<pre class="fragment"><code>
$ echo "Hello toto" | sed 's/o/a/'
$ echo "Hello toto" | sed 's/o/a/g'
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>datamash</h2>
					<p>
						<a href="https://commons.wikimedia.org/wiki/File:Paul_charts_2003.gif"><img src="images/Paul_charts_2003.gif" style="width: 20%;"></a>
						<br>
						<small style="font-size: 40%">© Lorillou, CC-BY-SA 2.5</small>
					</p>
					<ul>
						<li>Calculs statistiques rapides</li>
					</ul>
					<pre class="fragment"><code>
$ seq 10 | datamash sum 1 mean 1
55 5.5
					</code></pre>
					<pre class="fragment"><code>
$ datamash -s -g 13 count 2 < genes.txt
ABCC1   1
ABCC10  2
ABCC11  3
…
					</code></pre>
					<pre class="fragment"><code>
$ datamash -H mean 1 q1 1 median 1 q3 1 iqr 1 sstdev 1 jarque 1 < FILE.TXT
mean(x)   q1(x)  median(x)  q3(x)   iqr(x)  sstdev(x)  jarque(x)
45.32     23     37         61.5    38.5    30.4487    8.0113e-09
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Synonymes : WOLF</h2>
					<blockquote cite="https://fr.wikipedia.org/wiki/Combinaison_(math%C3%A9matiques)" style="font-size: 90%; width: 90%">
En mathématiques, lorsqu'on choisit k objets parmi n objets discernables (numérotés de 1 à n) et que l’ordre dans lequel les objets sont placés (ou énumérés) n’a pas d’importance, on peut les représenter par un ensemble à k éléments. Les combinaisons servent donc, entre autres, en combinatoire.
					</blockquote>
					<ul>
						<li><a href="https://fr.wikipedia.org/wiki/Combinaison_(math%C3%A9matiques)">fr.wikipedia.org/wiki/Combinaison_(mathématiques)</a></li>
					</ul>
					<pre class="fragment"><code>
#! /usr/bin/env python3
import math, sys
f = math.factorial
for line in sys.stdin:
    count = int(line.rstrip())
    print(f(count) / f(2) / f(count - 2))
					</code></pre>
					<pre class="fragment"><code>
$ < counts.lst
   count_combinations.py | \
   datamash sum 1
70039
					</code></pre>
					<ul class="fragment">
						<li>62 452 entrées</li>
						<li>70 039 relations</li>
						<li>… un peu en vrac, il faut avouer.</li>
					</ul>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Synonymes : Wiktionnaire</h2>
					<p>
						<a href="https://commons.wikimedia.org/wiki/File:WiktionaryFr.svg"><img src="images/WiktionaryFr.svg.png" style="width: 20%;"></a>
						<br>
						<small style="font-size: 40%">© Contributeurs du wiktionnaire, CC-BY-SA 3.0</small>
					</p>
					<ul>
						<li>« Le dictionnaire libre »</li>
					</ul>
					<pre class="fragment"><code>
$ wget 'https://dumps.wikimedia.org/frwiktionary/latest/frwiktionary-latest-pages-meta-current.xml.bz2' -O - | \
   bunzip2 > frwikt-20160804.xml
					</code></pre>
					<pre class="fragment"><code>
$ less frwikt-20160804.xml
					</code></pre>
					<pre class="fragment"><code>
$ grep synonymes --color=always --after-context=15 frwikt-20160804.xml | head -n 30
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>grep</h2>
					<p>
						<a href="https://commons.wikimedia.org/wiki/File:Red-eyed_Treefrog_(Agalychnis_callidryas).jpg"><img src="images/Red-eyed_Treefrog_(Agalychnis_callidryas).jpg" style="width: 20%;"></a>
						<br>
						<small style="font-size: 40%">© Brian Gratwicke, CC-BY 2.0</small>
					</p>
					<ul>
						<li>Filtrer du texte</li>
					</ul>
					<pre class="fragment"><code>
$ echo foo | grep fo
$ echo foo | grep -v fo
					</code></pre>
					<pre class="fragment"><code>
$ echo wikimedia | grep wiki --color=always
					</code></pre>
					<pre class="fragment"><code>
grep hello --after-context=21
grep by --before-context=42
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Synonymes : Wiktionnaire</h2>
					<pre style="height:80%"><code style="height:100%; max-height: 100%">
#! /usr/bin/env python3

import xml.sax

class Page:

    def __init__(self, ns, title, text):
        self.ns = ns
        self.title = title
        self.text = text

class Handler(xml.sax.handler.ContentHandler):

    def __init__(self, callback):
        super().__init__()
        self.__pageContent = {}
        self.__currentTag = ''
        self.__callback = callback

    def startElement(self, name, attrs):
        if name == 'page':
            self.__pageContent = {}
        self.__currentTag = name

    def endElement(self, name):
        if name == 'page':
            self.__callback(Page(
                int(''.join(self.__pageContent.get('ns', []))),
                ''.join(self.__pageContent.get('title', [])),
                ''.join(self.__pageContent.get('text', []))
            ))
        self.__currentTag = ''

    def __append(self, content):
        self.__pageContent.setdefault(self.__currentTag, []).append(content)

    characters = __append
    ignorableWhiteSpace = __append

def parseWithCallback(inputFileName, callback):
    parser = xml.sax.make_parser()
    parser.setContentHandler(Handler(callback))
    parser.parse(inputFileName)

def matchOn(string):
    match = [None]
    def on(reg):
        match[0] = reg.search(string)
        return match[0]
    def _(group):
        return match[0].group(group)
    return on, _

def matchOnLines(text):
    for line in text.split('\n'):
        on, _ = matchOn(line)
        yield line, on, _
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Synonymes : Wiktionnaire</h2>
					<pre style="height:80%"><code style="height:100%; max-height: 100%">
#! /usr/bin/env python3

import sys
import wikidump

def processPage(page):

    print('=' * 80)
    print(page.ns)
    print(page.title)
    print(page.text)

if __name__ == '__main__':

    if len(sys.argv) != 2:
        print('Usage: {} wikiDump.xml'.format(sys.argv[0].split(os.sep)[-1]))
        sys.exit(1)

    wikidump.parseWithCallback(sys.argv[1], processPage)
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Synonymes : Wiktionnaire</h2>
					<pre style="height:80%"><code style="height:100%; max-height: 100%">
#! /usr/bin/env python3

import re
import sys
import wikidump

_lang = re.compile(r'=+\s*\{\{langue\|(?P&lt;lang>.+?)\}\}\s*=+')
_synonyms = re.compile(r'=+\s*\{\{S\|synonymes\}\}\s*=+')
_title = re.compile(r'^=+\s*=+')
_word = re.compile(r'^\*\s*\[\[(.+?\|)?(?P&lt;word>.+?)\]\]')

def processPage(page):

    if page.ns == 0:

        keepWords = False
        lang = 'fr'

        for line, on, _ in wikidump.matchOnLines(page.text):

            if on(_synonyms):
                keepWords = True
            elif on(_lang):
                lang = _('lang')
            elif on(_title):
                keepWords = False

            if keepWords and lang == 'fr' and on(_word):
                print(page.title + ' → ', _('word'))

if __name__ == '__main__':

    if len(sys.argv) != 2:
        print('Usage: {} wikiDump.xml'.format(sys.argv[0].split(os.sep)[-1]))
        sys.exit(1)

    wikidump.parseWithCallback(sys.argv[1], processPage)
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Synonymes : Wiktionnaire</h2>
					<pre style="height:80%"><code style="height:100%; max-height: 100%" data-noescape>
#! /usr/bin/env python3

import re
import sys
import wikidump

_lang = re.compile(r'=+\s*\{\{langue\|(?P&lt;lang>.+?)\}\}\s*=+')
_synonyms = re.compile(r'=+\s*\{\{S\|synonymes\}\}\s*=+')
_title = re.compile(r'^=+\s*=+')
_word = re.compile(r'^\*\s*\[\[(.+?\|)?(?P&lt;word>.+?)\]\]')

<mark>words = set()
relations = set()</mark>

def processPage(page):

    if page.ns == 0:

        keepWords = False
        lang = 'fr'

        for line, on, _ in wikidump.matchOnLines(page.text):

            if on(_synonyms):
                keepWords = True
            elif on(_lang):
                lang = _('lang')
            elif on(_title):
                keepWords = False

            if keepWords and lang == 'fr' and on(_word):
                <mark>words.add(page.title)
                words.add(_('word'))
                relations.add(tuple(sorted([page.title, _('word')])))</mark>

if __name__ == '__main__':

    if len(sys.argv) != 2:
        print('Usage: {} wikiDump.xml'.format(sys.argv[0].split(os.sep)[-1]))
        sys.exit(1)

    wikidump.parseWithCallback(sys.argv[1], processPage)

    <mark>print('words', len(words))
    print('relations', len(relations))</mark>
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Synonymes : Wiktionnaire</h2>
					<pre><code>
$ ./extract_synonyms.py frwikt.xml  | head -n 25
accueil →  home
accueil →  main page
accueil →  page d’accueil
siège →  cul
siège →  derrière
siège →  fondement
siège →  blocus
meuble →  garniture
meuble →  mobilier
militaire →  martial
militaire →  guerrier
militaire →  soldat
militaire →  trouffion
militaire →  bidasse
militaire →  chair à canon
militaire →  fantassin
militaire →  gendarme
militaire →  mercenaire
militaire →  milicien
manchot →  unibrassiste
manchot →  manchois
manchot →  unibrassiste
bande dessinée →  art
bande dessinée →  bédé
bande dessinée →  illustré
					</code></pre>
					<pre class="fragment"><code>
$ ./count_synonyms.py frwikt-20160804.xml
words 67449
relations 61562
./count_synonyms.py frwikt.xml  279,07s user 1,08s system 99% cpu 4:40,26 total
					</code></pre>
					<ul class="fragment">
						<li>67 449 entrées</li>
						<li>61 562 relations</li>
						<li>… de qualité <em>franchement</em> acceptable.</li>
					</ul>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Synonymes : comparaison</h2>
					<table>
						<thead>
							<tr>
								<th></th>
								<th>DES</th>
								<th>WOLF</th>
								<th>Wiktionnaire</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th>Entrées</th>
								<td>49 332</td>
								<td>62 452</td>
								<td><strong style="color: green">67 449</strong></td>
							</tr>
							<tr>
								<th>Relations</th>
								<td><strong style="color: green">203 797</strong></td>
								<td>70 039</td>
								<td>61 562</td>
							</tr>
							<tr>
								<th>Qualité</th>
								<td><strong style="color: green">Exceptionnelle</strong></td>
								<td>Perfectible</td>
								<td>Très bonne</td>
							</tr>
							<tr class="fragment">
								<th>Effort</th>
								<td>« l’INALF […] le laboratoire ELSAP […] le CRISCO […] depuis 1994, un important travail […] la collaboration des utilisateurs […] davantage de moyens humains »</td>
								<td>« Sagot et Fišer 2008a, Sagot et Fišer 2008b, Fišer et Sagot 2008 […] Sagot, Fort et Venant 2009a, Sagot, Fort et Venant 2009b […] Sagot et Fišer 2011, Sagot et Fišer 2012a […] Gábor et al. 2012 […] Apidianaki et Sagot, 2012 […] Hanoka et Sagot 2012 […] Sagot et Fišer, 2012b »</td>
								<td><strong style="color: green">Quelques dizaines de minutes</strong><em class="fragment"> … et le travail de quelques milliers de contributeurs :)</em></td>
							</tr>
						</tbody>
					</table>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Statistiques</h2>
					<p>
						<blockquote cite="#">
… et le travail de quelques milliers de contributeurs :)
						</blockquote>
						— Arkanosis, 21 août 2016
					</p>
					<ul class="fragment">
						<li>Oui, mais <em>combien</em> ?</li>
						<li class="fragment"><a href="https://fr.wiktionary.org/wiki/Sp%C3%A9cial:Statistiques">[[Spécial:Statistiques]]</a></li>
						<li class="fragment">Mmh…</li>
						<li class="fragment"><a href="https://fr.wiktionary.org/wiki/Spécial%3AListe_des_utilisateurs">[[Spécial:Liste_des_utilisateurs]]</a><ul class="fragment">
							<li><a href="https://fr.wiktionary.org/w/index.php?title=Spécial%3AListe_des_utilisateurs&username=&group=&editsOnly=1&limit=50">[[Spécial:Liste_des_utilisateurs]] + <code>&amp;editsOnly=1</code></a></li>
						</ul></li>
					</ul>
					<pre class="fragment"><code>
$ curl 'https://fr.wiktionary.org/w/api.php?action=query&amp;list=allusers&amp;auwitheditsonly=true&amp;format=json'
					</code></pre>
					<pre class="fragment"><code>
$ http 'https://fr.wiktionary.org/w/api.php' \
  action==query \
  list==allusers \
  auwitheditsonly==true \
  format==json
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Statistiques : API</h2>
					<pre style="height:80%"><code style="height:100%; max-height: 100%">
$ from=''
  count=0
  while true; do
    echo $count $from
    users=$(http 'https://fr.wiktionary.org/w/api.php' \
      action==query \
      list==allusers \
      auwitheditsonly==true \
      aufrom==$from \
      aulimit==500 \
      format==json)
    from=$(echo $users | jq -r '.continue.aufrom')
    [[ $from = null ]] &amp;&amp; break
    count=$((count + 500))
  done
  count=$((count + $(echo $users | jq '.query.allusers | length')))
  echo $count
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Statistiques : API</h2>
					<pre style="height:80%"><code style="height:100%; max-height: 100%">
$ time (
  from=''
  count=0
  while true; do
    echo $count $from
    users=$(http 'https://fr.wiktionary.org/w/api.php' \
      action==query \
      list==allusers \
      auwitheditsonly==true \
      aufrom==$from \
      aulimit==500 \
      format==json)
    from=$(echo $users | jq -r '.continue.aufrom')
    [[ $from = null ]] &amp;&amp; break
    count=$((count + 500))
  done
  count=$((count + $(echo $users | jq '.query.allusers | length')))
  echo $count
  )
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Statistiques : API</h2>
					<pre style="height:80%"><code style="height:100%; max-height: 100%">
$ time (
  from=''
  count=0
  while true; do
    echo $count $from
    users=$(http 'https://fr.wiktionary.org/w/api.php' \
      action==query \
      list==allusers \
      auwitheditsonly==true \
      aufrom==$from \
      aulimit==500 \
      format==json)
    from=$(echo $users | jq -r '.continue.aufrom')
    [[ $from = null ]] &amp;&amp; break
    count=$((count + 500))
  done
  count=$((count + $(echo $users | jq '.query.allusers | length')))
  echo $count
  )
0
500 Alf.68
1000 Astrée
1500 Bibliocaser
2000 Carnby
2500 Copyrightdl
3000 Dicolinguiste
3500 Elsewhere
4000 Florent45
4500 Ghuysmans99
5000 Hendumaica
5500 Jack Merridew
6000 Josie92
6500 Kronf
7000 Linotte13
7500 ManuelBrereton
8000 Michka B
8500 NatouB
9000 Oratyon
9500 PhoebeBCQ
10000 Rantatero
10500 Saka876
11000 Snipre
11500 TcheBTchev
12000 Tyseria
12500 Wikiwoordfanaat
13000 Zoorin
13162
4,83s user 0,58s system 41% cpu 13,170 total
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Statistiques : SQL</h2>
					<p>
						<blockquote cite="#">
… et le travail de quelques milliers de contributeurs :)
						</blockquote>
						— Arkanosis, 21 août 2016
					</p>
					<ul>
						<li>Oui, mais <em>combien</em> ?</li>
						<li>13162 !</li>
						<li class="fragment">Peut-on aller plus vite ?</li>
						<li class="fragment"><em>Enter…</em> Wikimedia Tool Labs</li>
					</ul>
					<pre class="fragment"><code>
ssh login.tools.wmflabs.org # Enter Wikimedia Tool Labs
					</code></pre>
					<pre class="fragment"><code>
$ become artlist
					</code></pre>
					<ul class="fragment">
						<li><a href="https://tools.wmflabs.org/artlist/">tools.wmflabs.org/artlist/</a></li>
					</ul>
					<pre class="fragment"><code>
$ sql frwiktionary
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Statistiques : SQL</h2>
					<pre><code>
MariaDB [frwiktionary_p]> SELECT COUNT(*) FROM user WHERE user_editcount > 0;
+----------+
| COUNT(*) |
+----------+
|    13170 |
+----------+
1 row in set (0.09 sec)
					</code></pre>
					<ul class="fragment">
						<li>Conclusion 1 : on peut aller plus vite</li>
						<li class="fragment">Conclusion 2 : choisir le bon outil :)</li>
						<li class="fragment">Malheureusement, on n'a pas toujours le choix…<ul>
							<li class="fragment"><a href="https://fr.wikipedia.org/wiki/Wikip%C3%A9dia:Prise_de_d%C3%A9cision/Crit%C3%A8res_d%27admissibilit%C3%A9_des_footballeurs">[[Wikipédia:Prise_de_décision/Critères_d'admissibilité_des_footballeurs]]</a></li>
						</ul></li>
					</ul>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Réplicats des bases de données (Tool Labs)</h2>
					<p>
						<a href="https://commons.wikimedia.org/wiki/File:MediaWiki_1.24.1_database_schema.svg"><img src="images/MediaWiki_1.24.1_database_schema.svg.png" style="width: 50%;"></a>
						<br>
						<small style="font-size: 40%">© Krinkle, CC-BY-SA 3.0</small>
					</p>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Réplicats des bases de données (Tool Labs)</h2>
					<ul>
						<li>Nombre de contributions dans un espace de nom donné</li>
					</ul>
					<pre class="fragment"><code>
SELECT page_title, COUNT(*)
  FROM revision_userindex
JOIN page
  ON page_id = rev_page
JOIN user
  ON user_id = rev_user
WHERE user_name = 'Arktest'
  AND page_namespace = 4
GROUP BY page_title
ORDER BY COUNT(*) DESC
LIMIT 30;
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>DBpedia</h2>
					<p>
						<a href="https://commons.wikimedia.org/wiki/File:DBpediaLogo.svg"><img src="images/2000px-DBpediaLogo.svg.png" style="width: 20%;"></a>
						<br>
						<small style="font-size: 40%">c̶ The DBpedia Team, DP</small>
					</p>
					<ul>
						<li><a href="http://fr.dbpedia.org/">fr.dbpedia.org</a></li>
						<li class="fragment"><a href="http://fr.dbpedia.org/dumps.html">fr.dbpedia.org/dumps.html</a></li>
						<li class="fragment"><a href="http://fr.dbpedia.org/sparqlEditor/index.html">fr.dbpedia.org/sparqlEditor</a></li>
					</ul>
					<pre class="fragment"><code>
PREFIX db-owl: &lt;http://dbpedia.org/ontology/>

SELECT * WHERE {
  ?ville db-owl:region &lt;http://fr.dbpedia.org/resource/Île-de-France> .
  ?ville rdf:type db-owl:Settlement .
  ?ville db-owl:populationTotal ?population .
  FILTER (?population > 100000)
}
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Wikidata</h2>
					<p>
						<a href="https://commons.wikimedia.org/wiki/File:Wikidata-logo-en.svg"><img src="images/2000px-Wikidata-logo-en.svg.png" style="width: 20%;"></a>
						<br>
						<small style="font-size: 40%">c̶ Planemad, DP</small>
					</p>
					<ul>
						<li><a href="https://query.wikidata.org/">query.wikidata.org</a></li>
					</ul>
					<pre class="fragment"><code>
PREFIX wd: &lt;http://www.wikidata.org/entity/>
PREFIX wdt: &lt;http://www.wikidata.org/prop/direct/>

SELECT ?pays WHERE {
  wd:Q90 wdt:P1376 ?pays
}
					</code></pre>
					<pre class="fragment"><code>
SELECT ?eyeColorLabel (COUNT(?person) AS ?count)
WHERE {
  ?person wdt:P1340 ?eyeColor
  SERVICE wikibase:label { bd:serviceParam wikibase:language "fr" }
}
GROUP BY ?eyeColorLabel
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>Service rapide</h2>
					<p>
						<a href="https://commons.wikimedia.org/wiki/File:2013_Australian_Open_-_Guillaume_Rufin.jpg"><img src="images/2013_Australian_Open_-_Guillaume_Rufin.jpg" style="width: 15%;"></a>
						<br>
						<small style="font-size: 40%">© Brendan Dennis, CC-BY-SA 3.0</small>
					</p>
					<ul>
						<li><a href="https://www.google.fr/search?q=country+phone+code">google://country+phone+code</a></li>
					</ul>
					<pre class="fragment"><code>
SELECT ?countryLabel ?itu ?iso2 ?iso3 ?pop ?sup ?gdp
WHERE {
  ?country wdt:P474 ?itu ;
           wdt:P297 ?iso2 ;
           wdt:P298 ?iso3 ;
           wdt:P1082 ?pop ;
           wdt:P2046 ?sup ;
           wdt:P2131 ?gdp .
  SERVICE wikibase:label { bd:serviceParam wikibase:language "fr" }
}
ORDER BY ASC(?countryLabel)
					</code></pre>
					<p>
						<small style="font-size: 50%" class="caption">© <a href="http://fr.wikipedia.org/wiki/User:Arkanosis"><span style="color:gray">User:</span>Arkanosis</a> — CC-BY 4.0 — WikiConvention francophone 2016</small>
					</p>
				</section>
				<section>
					<h2>~~~~</h2>
					<p>
						<a href="https://commons.wikimedia.org/wiki/File:WMF_office_shots_April_2016-12.jpg"><img src="images/WMF_office_shots_April_2016-12.jpg" style="width: 500.0px;"></a>
						<br>
						<small style="font-size: 40%">© Victor Grigas, CC-BY-SA 3.0</small>
					</p>
					<ul>
						<li><a href="http://fr.wikipedia.org/wiki/User_talk:Arkanosis">frwp.org/User:Arkanosis</a></li>
						<li><a href="mailto:jroquet@arkanosis.net">jroquet@arkanosis.net</a></li>
						<li><a href="#">@Arkanosis</a> <small>freenode, GitHub, Twitter…</small></li>
					</ul>
				</section>
			</div>
		</div>

		<script src="../reveal.js/lib/js/head.min.js"></script>
		<script src="../reveal.js/js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				width: '100%',
				height: '100%',

				history: true,

				keyboard: {
					'0': 'togglePause',
					'9': 'toggleOverview',
					'38': 'navigateLeft',
					'40': 'navigateRight'
				},

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: '../reveal.js/plugin/zoom-js/zoom.js' },
					{ src: '../reveal.js/plugin/markdown/marked.js' },
					{ src: '../reveal.js/plugin/markdown/markdown.js' },
					{ src: '../reveal.js/plugin/notes/notes.js', async: true },
					{ src: '../reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
